<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Awesome Product – Pre‑Order Now!</title>

  <!-- External stylesheet -->
  <link rel="stylesheet" href="style.css"/>

  <!-- Stripe.js -->
  <script src="https://js.stripe.com/v3"></script>
</head>
<body>
  <div class="page-container">
    <!-- Login icon -->
    <button id="login-button">Login</button>

    <!-- ── HEADER ─────────────────────────────────────────────────────────── -->
    <header class="product-header">
      <h1>Awesome Product Name</h1>
      <p class="tagline">The revolutionary gadget you've been waiting for!</p>
    </header>

    <!-- ── PRODUCT VIDEO ──────────────────────────────────────────────────── -->
    <section class="product-video">
      <video
        poster="https://via.placeholder.com/1180x664/f7f8f9/aaaaaa?text=Clean+Video+Placeholder"
        controls preload="metadata">
        <source src="111.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </section>

    <!-- ── NAVIGATION ─────────────────────────────────────────────────────── -->
    <nav class="campaign-nav">
      <ul>
        <li><a href="#story" class="active">Campaign</a></li>
        <li><a href="#risks">Risks</a></li>
        <li><a href="#comments-section">Comments</a></li>
        <li><a href="#faq">FAQ</a></li>
        <li><a href="#updates">Updates</a></li>
      </ul>
    </nav>

    <!-- ── BODY ───────────────────────────────────────────────────────────── -->
    <div class="campaign-body">
      <!-- Main campaign content -->
      <main class="campaign-content">
        <!-- Story -->
        <section id="story">
          <h2>The Story Behind Awesome Product</h2>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse feugiat, elit quis tristique dictum, odio ligula consequat libero, at iaculis tortor neque ut justo.</p>
          <img src="https://via.placeholder.com/700x400/e9ecef/333333?text=Minimal+Product+View" alt="Detailed view of Awesome Product">
          <p>Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nulla facilisi.</p>
          <img src="https://via.placeholder.com/700x400/f8f9fa/333333?text=Clean+Usage+Example" alt="Awesome Product being used">
          <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem.</p>
        </section>

        <!-- Risks -->
        <section id="risks">
          <h2>Risks and Challenges</h2>
          <p>Bringing hardware to market always carries risk. Potential challenges include:</p>
          <ul>
            <li>Supply‑chain disruptions</li>
            <li>Certification delays</li>
            <li>Manufacturing defects</li>
          </ul>
          <p>We mitigate these by working with seasoned partners and keeping buffers in our timeline.</p>
        </section>

        <!-- Comments -->
        <section id="comments-section">
          <h2>Comments</h2>
          <div id="comments-list">
            <!-- Loaded by JS -->
          </div>
          <form id="comment-form">
            <h3>Leave a Comment</h3>
            <div>
              <label for="comment-email">Email (for verification):</label>
              <input type="email" id="comment-email" name="email" required>
            </div>
            <div>
              <label for="comment-text">Comment:</label>
              <textarea id="comment-text" name="comment" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn">Submit Comment</button>
          </form>
        </section>

        <!-- Placeholders -->
        <section id="faq" style="min-height:100px"><h2>FAQ (Placeholder)</h2></section>
        <section id="updates" style="min-height:100px"><h2>Updates (Placeholder)</h2></section>
      </main>

      <!-- Pricing sidebar -->
      <aside class="pricing-sidebar">
        <div class="pricing-section">
          <div class="full-price-info">
            Full Retail Price: <strong id="full-price-display">$0.00</strong>
          </div>

          <!-- Deposit -->
          <div class="option-card">
            <h3>Pay Deposit</h3>
            <div class="price-display" id="deposit-price-display">$0.00</div>
            <p class="description" id="deposit-description">
              Secure your Awesome Product now! Pay <strong>$XXX.XX</strong> today (30% of full price) and the remaining <strong>$YYY.YY</strong> upon shipment.
            </p>
            <button class="btn btn-deposit" id="deposit-button">Deposit Now</button>
          </div>

          <!-- Buy Now -->
          <div class="option-card">
            <h3>Buy Now &amp; Save<span class="discount-badge">30% OFF</span></h3>
            <div class="price-display" id="buy-now-price-display">
              <span class="original-price" id="buy-now-original-price">$0.00</span>
              $0.00
            </div>
            <p class="description">
              Get the best deal! Pay the full discounted price today and save 30% off the retail value. Receive your Awesome Product as soon as it ships.
            </p>
            <button class="btn btn-buy" id="buy-now-button">Buy Now</button>
          </div>

          <!-- Deluxe -->
          <div class="option-card">
            <h3>Deluxe Bundle</h3>
            <div class="price-display">$450.00</div>
            <p class="description">Get the Awesome Product plus exclusive accessories! Includes Accessory 1 and Accessory 2.</p>
            <button class="btn btn-buy" data-amount="450">Pledge $450</button>
          </div>
        </div>
      </aside>
    </div>

  </div><!-- /.page-container -->

  <!-- ── FOOTER ───────────────────────────────────────────────────────────── -->
  <footer>
    Help bring creative projects to life. | © 2025 Your Company
  </footer>

  <!-- ────────────────────────────────────────────────────────────────────────
       MODALS
  ------------------------------------------------------------------------- -->
  <!-- Purchase OTP -->
  <div id="purchase-otp-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Verify to Purchase</h3>
      <label><input type="radio" name="purchase-contact-method" value="email" checked> Email</label>
      <label><input type="radio" name="purchase-contact-method" value="sms"> Phone</label>
      <input id="purchase-contact-value" type="email" placeholder="Enter email address">
      <button id="purchase-send-otp-btn">Send OTP</button>
      <div id="purchase-otp-section" style="display:none">
        <input id="purchase-otp-code" placeholder="Enter OTP">
        <button id="purchase-verify-otp-btn">Verify OTP</button>
      </div>
    </div>
  </div>

  <!-- Shipping -->
  <div id="shipping-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Shipping &amp; Contact</h3>
      <form id="shipping-form">
        <input name="ship-name"    placeholder="Full Name"       required>
        <input name="ship-address" placeholder="Street Address"  required>
        <input name="ship-city"    placeholder="City"            required>
        <input name="ship-country" placeholder="Country"         required>
        <input name="ship-phone"   placeholder="Phone Number"    required>
        <button type="submit">Continue to Payment</button>
      </form>
    </div>
  </div>

  <!-- Login -->
  <div id="login-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Login / Profile</h3>
      <label><input type="radio" name="login-contact-method" value="email" checked> Email</label>
      <label><input type="radio" name="login-contact-method" value="sms"> Phone</label>
      <input id="login-contact-value" type="email" placeholder="Enter email address">
      <button id="login-send-otp-btn">Send OTP</button>
      <div id="login-otp-section" style="display:none">
        <input id="login-otp-code" placeholder="Enter OTP">
        <button id="login-verify-otp-btn">Verify &amp; Load Profile</button>
      </div>
    </div>
  </div>

  <!-- Profile -->
  <div id="profile-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Your Profile</h3>
      <p id="profile-contact"></p>
      <h4>Order History</h4>
      <ul id="order-history"></ul>
      <button onclick="document.getElementById('profile-modal').classList.add('hidden')">Close</button>
    </div>
  </div>

  <!-- ────────────────────────────────────────────────────────────────────────
       SCRIPTS
  ------------------------------------------------------------------------- -->
  <script>
  /* ── Stripe object ────────────────────────────────────────────────────── */
  const stripe = Stripe('YOUR_STRIPE_PUBLISHABLE_KEY');

  /* ── Pricing constants ────────────────────────────────────────────────── */
  const FULL_PRICE = 390;
  const DISCOUNT_PCT = 0.30;
  const DEPOSIT_PCT  = 0.30;
  const depositAmount   = FULL_PRICE * DEPOSIT_PCT;
  const discountedPrice = FULL_PRICE * (1 - DISCOUNT_PCT);

  /* ── Helper functions ─────────────────────────────────────────────────── */
  const formatCurrency = a => \`$\${a.toFixed(2)}\`;

  async function sendOtp(method, value){
    const res = await fetch('/api/send-otp',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({contactMethod:method,contactValue:value})
    });
    return (await res.json()).success;
  }
  async function verifyOtp(method, value, code){
    const res = await fetch('/api/verify-otp',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({contactMethod:method,contactValue:value,code})
    });
    return (await res.json()).verified;
  }

  /* ── Comments local‑storage helpers ───────────────────────────────────── */
  const COMMENTS_KEY = 'awesomeProductComments_v1';
  const loadComments = () => {
    const list = document.getElementById('comments-list');
    list.innerHTML = '';
    const arr = JSON.parse(localStorage.getItem(COMMENTS_KEY)||'[]');
    if (!arr.length){
      list.innerHTML = '<p style="color:var(--medium-gray);text-align:center">No comments yet.</p>';
    } else {
      arr.forEach(displayComment);
    }
  };
  const displayComment = c => {
    const d = document.createElement('div'); d.className='comment';
    const s = document.createElement('strong'); s.textContent = c.email+' (Demo)';
    const p = document.createElement('p');     p.textContent = c.text;
    d.append(s,p);
    document.getElementById('comments-list').appendChild(d);
  };
  const saveComment = c => {
    const arr = JSON.parse(localStorage.getItem(COMMENTS_KEY)||'[]');
    arr.push(c);
    localStorage.setItem(COMMENTS_KEY,JSON.stringify(arr));
    displayComment(c);
  };

  /* ── DOMContentLoaded ─────────────────────────────────────────────────── */
  document.addEventListener('DOMContentLoaded',()=>{
    /* ----- Populate prices ----- */
    document.getElementById('full-price-display').textContent    = formatCurrency(FULL_PRICE);
    document.getElementById('deposit-price-display').textContent = formatCurrency(depositAmount);
    document.getElementById('deposit-description').innerHTML =
      \`Secure your Awesome Product now! Pay <strong>\${formatCurrency(depositAmount)}</strong> today (30%) and the remaining <strong>\${formatCurrency(FULL_PRICE-depositAmount)}</strong> upon shipment.\`;
    document.getElementById('buy-now-original-price').textContent = formatCurrency(FULL_PRICE);
    const buyNowDisp = document.getElementById('buy-now-price-display');
    buyNowDisp.childNodes[buyNowDisp.childNodes.length-1].nodeValue = \` \${formatCurrency(discountedPrice)}\`;

    /* ----- Purchase flow ----- */
    let purchaseAmount = 0;
    document.querySelectorAll('.btn-deposit, .btn-buy').forEach(btn=>{
      btn.addEventListener('click',()=>{
        if (btn.id==='deposit-button')      purchaseAmount = depositAmount;
        else if (btn.id==='buy-now-button') purchaseAmount = discountedPrice;
        else                                purchaseAmount = parseFloat(btn.dataset.amount);
        document.getElementById('purchase-otp-modal').classList.remove('hidden');
      });
    });

    /* contact method switch */
    document.getElementsByName('purchase-contact-method').forEach(r=>{
      r.addEventListener('change',e=>{
        const inp=document.getElementById('purchase-contact-value');
        if(e.target.value==='sms'){inp.type='tel';inp.placeholder='Enter phone number'}
        else{inp.type='email';inp.placeholder='Enter email address'}
      });
    });

    /* send OTP (purchase) */
    document.getElementById('purchase-send-otp-btn').addEventListener('click',async()=>{
      const method=document.querySelector('input[name="purchase-contact-method"]:checked').value;
      const val=document.getElementById('purchase-contact-value').value.trim();
      if(!val) return alert('Enter contact.');
      if(await sendOtp(method,val)){
        document.getElementById('purchase-otp-section').style.display='block';
        document.getElementById('purchase-send-otp-btn').disabled=true;
      }else alert('Failed to send OTP.');
    });

    /* verify OTP (purchase) */
    let currentContactMethod,currentContactValue;
    document.getElementById('purchase-verify-otp-btn').addEventListener('click',async()=>{
      const method=document.querySelector('input[name="purchase-contact-method"]:checked').value;
      const val=document.getElementById('purchase-contact-value').value.trim();
      const code=document.getElementById('purchase-otp-code').value.trim();
      if(!code) return alert('Enter OTP.');
      if(await verifyOtp(method,val,code)){
        currentContactMethod=method;currentContactValue=val;
        document.getElementById('purchase-otp-modal').classList.add('hidden');
        document.getElementById('shipping-modal').classList.remove('hidden');
      }else alert('Incorrect OTP.');
    });

    /* shipping form → Stripe */
    document.getElementById('shipping-form').addEventListener('submit',async e=>{
      e.preventDefault();
      const f=e.target;
      const shipping={
        name:f['ship-name'].value,
        address:f['ship-address'].value,
        city:f['ship-city'].value,
        country:f['ship-country'].value,
        phone:f['ship-phone'].value
      };
      const res=await fetch('/api/checkout',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          amount:purchaseAmount,
          contactMethod:currentContactMethod,
          contactValue:currentContactValue,
          shipping
        })
      });
      const {sessionUrl}=await res.json();
      window.location=sessionUrl;
    });

    /* ----- Login flow ----- */
    document.getElementById('login-button').addEventListener('click',()=>{
      document.getElementById('login-modal').classList.remove('hidden');
    });
    document.getElementsByName('login-contact-method').forEach(r=>{
      r.addEventListener('change',e=>{
        const inp=document.getElementById('login-contact-value');
        if(e.target.value==='sms'){inp.type='tel';inp.placeholder='Enter phone number'}
        else{inp.type='email';inp.placeholder='Enter email address'}
      });
    });
    document.getElementById('login-send-otp-btn').addEventListener('click',async()=>{
      const method=document.querySelector('input[name="login-contact-method"]:checked').value;
      const val=document.getElementById('login-contact-value').value.trim();
      if(!val) return alert('Enter contact.');
      if(await sendOtp(method,val)){
        document.getElementById('login-otp-section').style.display='block';
        document.getElementById('login-send-otp-btn').disabled=true;
      }else alert('Failed to send OTP.');
    });
    document.getElementById('login-verify-otp-btn').addEventListener('click',async()=>{
      const method=document.querySelector('input[name="login-contact-method"]:checked').value;
      const val=document.getElementById('login-contact-value').value.trim();
      const code=document.getElementById('login-otp-code').value.trim();
      if(!code) return alert('Enter OTP.');
      if(await verifyOtp(method,val,code)){
        document.getElementById('login-modal').classList.add('hidden');
        const res=await fetch('/api/login',{
          method:'POST',headers:{'Content-Type':'application/json'},
          body:JSON.stringify({contactMethod:method,contactValue:val})
        });
        const j=await res.json();
        showProfileModal(j.user,j.orders);
      }else alert('Incorrect OTP.');
    });
    const showProfileModal=(user,orders)=>{
      document.getElementById('profile-contact').textContent=
        \`Signed in as \${user.contactMethod}: \${user.contactValue}\`;
      const ul=document.getElementById('order-history');ul.innerHTML='';
      if(!orders.length){ul.innerHTML='<li>No orders yet.</li>';}
      else orders.forEach(o=>{
        const li=document.createElement('li');
        li.textContent=\`Order \${o.id}: $\${o.amount.toFixed(2)} on \${new Date(o.created).toLocaleString()}\`;
        ul.appendChild(li);
      });
      document.getElementById('profile-modal').classList.remove('hidden');
    };

    /* ----- Comments with OTP ----- */
    document.getElementById('comment-form').addEventListener('submit',async e=>{
      e.preventDefault();
      const email=document.getElementById('comment-email').value.trim();
      const text =document.getElementById('comment-text').value.trim();
      if(!email||!text) return alert('Enter email & comment.');
      if(!(await sendOtp('email',email))) return alert('Failed to send OTP.');
      const code=prompt(\`Enter the OTP sent to \${email}\`);
      if(!code) return alert('Verification cancelled.');
      if(await verifyOtp('email',email,code)){
        saveComment({email,text,timestamp:new Date().toISOString()});
        document.getElementById('comment-email').value='';
        document.getElementById('comment-text').value='';
        alert('Comment added!');
      }else alert('Incorrect OTP.');
    });
    loadComments();

    /* ----- Campaign nav smooth scroll ----- */
    const navLinks=document.querySelectorAll('.campaign-nav a');
    const navBar=document.querySelector('.campaign-nav');
    const scrollOffset=(navBar?navBar.offsetHeight:0)+20;
    navLinks.forEach(link=>{
      link.addEventListener('click',e=>{
        e.preventDefault();
        navLinks.forEach(el=>el.classList.remove('active'));
        e.target.classList.add('active');
        const targetId=e.target.getAttribute('href');
        const target=document.querySelector(targetId);
        if(target){
          const pos=target.getBoundingClientRect().top+window.pageYOffset;
          const offsetPos=pos-scrollOffset;
          window.scrollTo({top:offsetPos,behavior:'smooth'});
        }
      });
    });

    /* ----- Dynamic border effect ----- */
    document.querySelectorAll('.campaign-content,.pricing-section,.option-card').forEach(el=>{
      el.addEventListener('mousemove',e=>{
        const r=el.getBoundingClientRect();
        const x=e.clientX-r.left, y=e.clientY-r.top;
        el.style.setProperty('--mouse-x',\`\${x}px\`);
        el.style.setProperty('--mouse-y',\`\${y}px\`);
      });
      el.addEventListener('mouseleave',()=>{
        el.style.setProperty('--mouse-x','-100px');
        el.style.setProperty('--mouse-y','-100px');
      });
    });

    /* ----- Card click = button click ----- */
    document.querySelectorAll('.option-card').forEach(card=>{
      card.addEventListener('click',e=>{
        if(e.target.tagName.toLowerCase()==='button')return;
        const btn=card.querySelector('.btn');if(btn)btn.click();
      });
    });
  });
  </script>
</body>
</html>
